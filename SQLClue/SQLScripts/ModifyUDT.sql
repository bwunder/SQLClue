-- verified on v1.3.5.8  

--stop the Automation Controller service and comment or remove this line before running this script.

SET NOCOUNT ON;
GO

-- fail if the temp table already exists
IF OBJECT_ID('SQLCfg.tempChange','U') IS NOT NULL
  RAISERROR('Modify_SQLCfgNode_UDT.sql aborted. Staging table [SQLCfg].[tempChange] already exists in the database.',20,1) WITH LOG;

GO
-- fail if idle connections held on the database
SELECT * FROM [sys].[dm_tran_locks]
WHERE [resource_type] = 'DATABASE'
AND [resource_database_id] = DB_ID()
And [request_session_id] <> @@SPID;

IF @@ROWCOUNT > 0
   RAISERROR('Modify_SQLCfgNode_UDT.sql aborted. There are users connected to the database.',20,1) WITH LOG;
           
GO

-- can be blocked by idle connections 
-- can always stop here, no harm done, if necessary
BEGIN TRY

 DECLARE @SetSingleUser as [NVARCHAR] (500);
 SET @SetSingleUser = 'ALTER DATABASE [' + DB_NAME() + '] SET SINGLE_USER';

 -- will use normal backup task start manual start at start of modification window
 -- fail here if the database has not been backed up at all in the last hour
 IF NOT EXISTS (SELECT * FROM [msdb].[dbo].[backupset] 
               WHERE [database_name] = DB_NAME()
               AND [backup_finish_date] > DATEADD(hour, -1, CURRENT_TIMESTAMP))
  BEGIN
   RAISERROR('Modify_SQLCfgNode_UDT.sql aborted. The database has not been backed up in the last hour',20,1) WITH LOG;
  END
 IF DATABASEPROPERTYEX(DB_NAME(), 'UserAccess') = 'MULTI_USER'
 AND OBJECT_ID('SQLCfg.tChange','U') IS NOT NULL
 AND TYPE_ID('SQLCfg.SQLCfgNode') IS NOT NULL
  BEGIN
   IF EXISTS (SELECT * 
              FROM [sys].[dm_exec_sessions] AS s
              JOIN [sys].[dm_exec_requests] AS r
              ON r.[session_id] = s.[session_id]
              WHERE r.[database_id] = DB_ID()
              AND s.[session_id] >= 50
              AND s.[session_id] <> @@SPID)
    BEGIN
     RAISERROR('Modify_SQLCfgNode_UDT.sql aborted. There are active request in the database.',20,1) WITH LOG;
    END 
   IF EXISTS (SELECT * 
              FROM [sys].[databases] 
              WHERE [name] = DB_NAME()
              AND [is_auto_update_stats_async_on] <> 0)
    BEGIN
     -- select * from sys.dm_exec_background_job_queue
     RAISERROR('Modify_SQLCfgNode_UDT.sql aborted at SET SINGLE_USER. AUTO_UPDATE_STATISTICS_ASYNC is enabled preventing the switch to single user mode.',20,1) WITH LOG;
    END 
   EXEC [dbo].[sp_executesql] @SetSingleUser;
  END  
 IF DATABASEPROPERTYEX(DB_NAME(), 'UserAccess') <> 'SINGLE_USER'
  BEGIN
   RAISERROR('Modify_SQLCfgNode_UDT.sql aborted at SET SINGLE_USER. The database is not single user',20,1) WITH LOG;
  END 
END TRY 
BEGIN CATCH
 DECLARE @Msg [NVARCHAR](1024);  
 SET @Msg = ERROR_MESSAGE();
 RAISERROR('Modify_SQLCfgNode_UDT.sql aborted at SET SINGLE_USER. Error Message: %s',20,1, @Msg) WITH LOG;
END CATCH

GO

 CREATE TABLE [SQLCfg].[tempChange] (
   [Id] [INT] NOT NULL 
 , [Node]  [NVARCHAR] (768) NOT NULL
 , [Version] [INT] NULL 
 , [Action] [NVARCHAR] (30) NOT NULL
 , [EventData] [XML] NULL  
 , [Definition] [NVARCHAR] (MAX) NULL
 , [DefinitionDt] [DATETIME] NULL
 , [RecCreatedDt] [DATETIME] NOT NULL 
 , CONSTRAINT [pkc_tempChange__Id] 
   PRIMARY KEY CLUSTERED ([Id]));

GO

IF EXISTS (SELECT * 
           FROM INFORMATION_SCHEMA.ROUTINES 
           WHERE SPECIFIC_SCHEMA = N'SQLCfg'
           AND SPECIFIC_NAME = N'pChangeApplyLabel' )
 DROP PROCEDURE [SQLCfg].[pChangeApplyLabel];

GO

IF EXISTS (SELECT * 
           FROM INFORMATION_SCHEMA.ROUTINES 
           WHERE SPECIFIC_SCHEMA = N'SQLCfg'
           AND SPECIFIC_NAME = N'fLastVersion' )
 DROP FUNCTION [SQLCfg].[fLastVersion];

GO

IF EXISTS (SELECT * 
           FROM [sys].[foreign_keys]
           WHERE [name] = 'fk_tChangeLabel__ChangeId__to__tChange')
 ALTER TABLE [SQLCfg].[tChangeLabel] 
 DROP CONSTRAINT [fk_tChangeLabel__ChangeId__to__tChange]
 
GO
IF  OBJECT_ID('[SQLCfg].[trgtSQLCfg_Insert_Update_Delete]','TR') IS NOT NULL
 DROP TRIGGER [SQLCfg].[trgtSQLCfg_Insert_Update_Delete]

GO
DECLARE @HoldingRowCount [INT]

SELECT COUNT(*) AS [RowCount]
INTO [SQLCfg].[Starting_tChange_rowcount]
FROM [SQLCfg].[tChange]
 
INSERT [SQLCfg].[tempChange]
 (  [Id]
 , [Node]
 , [Version]
 , [Action]
 , [EventData]
 , [Definition]
 , [DefinitionDt]
 , [RecCreatedDt])
SELECT 
   [Id]
 , [Node].ToString()
 , [Version]
 , [Action]
 , [EventData]
 , [Definition]
 , [DefinitionDt]
 , [RecCreatedDt]
FROM [SQLCfg].[tChange];

SET @HoldingRowCount = @@ROWCOUNT 

 -- verify the copy operation
 IF (SELECT [RowCount] FROM [SQLCfg].[Starting_tChange_rowcount]) <> @HoldingRowCount 
   RAISERROR('Refresh of SQLClueCLR assembly failed while saving off the existing table data to the holding table.',20,1) WITH LOG;

GO

 IF OBJECT_ID('SQLCfg.tChange','U') IS NOT NULL 
 AND OBJECT_ID('SQLCfg.tempChange','U') IS NOT NULL
  DROP TABLE [SQLCfg].[tChange]  

GO

 IF OBJECT_ID('SQLCfg.tChange','U') IS NULL 
 AND OBJECT_ID('SQLCfg.tempChange','U') IS NOT NULL
 AND TYPE_ID('SQLCfg.SQLCfgNode') IS NOT NULL
  DROP TYPE [SQLCfg].[SQLCfgNode]

GO

 IF OBJECT_ID('SQLCfg.tChange','U') IS NULL 
 AND OBJECT_ID('SQLCfg.tempChange','U') IS NOT NULL
 AND TYPE_ID('SQLCfg.SQLCfgNode') IS NULL
  DROP ASSEMBLY [SQLClueCLR]

GO

 IF  NOT EXISTS (SELECT * FROM [sys].[assemblies] WHERE [name] = N'SQLClueCLR')
  BEGIN
  EXEC sp_executesql N'CREATE ASSEMBLY [SQLClueCLR]
AUTHORIZATION [dbo]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010400DFA8EB490000000000000000E00002210B01080000260000000E0000000000008E45000000200000006000000000400000200000000200000400000000000000040000000000000000C000000004000070F30000020040850000100000100000000010000010000000000000100000000000000000000000384500005300000000800000C80800000000000000000000000000000000000000A000000C000000006000001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000094250000002000000026000000040000000000000000000000000000200000602E736461746100008E0000000060000000020000002A0000000000000000000000000000400000C02E72737263000000C808000000800000000A0000002C0000000000000000000000000000400000402E72656C6F6300000C00000000A00000000200000036000000000000000000000000000040000042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070450000000000004800000002000500D02B0000681900000900000000000000000000000000000050200000800000000000000000000000000000000000000000000000000000000000000000000000BD58853C1A382E9BE3327925AA6961255366BC3095E6D8792FCFF4BCE74C9EDC7ADB1F0AB5868F5654AEFEA802E9D1059AD60C6C9925D54F0F1DB019E9D6D9C5C1CD6A355CA6955D8CE4315EF1BC60254F02FB3F513695C1EF7DE12BB7FFA37A9F009B083004D7184DE566B14D2DCB79173A5AD8229EAB3E7D256019158D487A133001002500000001000011000228020000062C0A72010000700A2B122B0F00027B030000046F0400000A0A2B0100062A000000133001000C0000000200001100027B020000040A2B00062A133002001700000003000011001200FE15020000021200177D02000004060B2B00072A0013300500AC07000004000011000F00280500000A2C0B28030000060A3895070000001201FE150200000212010F00FE16040000016F0600000A7D03000004120112017B03000004178D0A0000010C08161F7C9D086F0700000A7D04000004120112017B040000048EB77D070000040012017B04000004169A0D0009720B00007016280800000A16404202000000120172290000707D05000004120112017B04000004179A7D0A0000040012017B0A0000041304001104723B00007016280800000A16332A00120172590000707D090000041201725B0000707D060000041201725B0000707D0C00000438DA010000001104726B00007016280800000A16334200120172970000707D06000004120112017B04000004189A7D08000004120112017B04000004199A7D09000004120112017B04000004199A7D0C000004388701000000110472B300007016280800000A16334200120172C90000707D06000004120112017B04000004189A7D08000004120112017B04000004199A7D09000004120112017B04000004199A7D0C000004383401000000110472DB00007016280800000A16333E00120172FF0000707D06000004120112017B04000004189A7D08000004120172590000707D09000004120112017B04000004189A7D0C00000438E5000000001104721301007016280800000A16333E00120172350100707D06000004120112017B04000004189A7D08000004120172590000707D09000004120112017B04000004189A7D0C0000043896000000001104724301007016280800000A16333B00120172690100707D06000004120112017B04000004189A7D08000004120172590000707D09000004120112017B04000004189A7D0C0000042B4A001104727F01007016280800000A16333900120172A10100707D06000004120112017B04000004189A7D08000004120172590000707D09000004120112017B04000004189A7D0C0000040038E304000000120172B30100707D05000004120112017B04000004169A7D08000004120172350100707D06000004120172590000707D09000004120172590000707D0A000004120172590000707D0B000004120172590000707D0C00000412017B040000048EB7173315120112017B04000004169A7D0C00000438680400000012017B04000004179A72CB01007016280800000A16FE0112017B04000004179A72EB01007016280800000A16FE016012017B04000004179A720702007016280800000A16FE016012017B04000004179A722702007016280800000A16FE016012017B04000004179A723F02007016280800000A16FE016012017B04000004179A724902007016280800000A16FE016012017B04000004179A726302007016280800000A16FE016012017B04000004179A728502007016280800000A16FE016012017B04000004179A729702007016280800000A16FE01602C15120112017B04000004179A7D0C000004384F03000012017B04000004179A72B302007016280800000A16FE0112017B04000004179A72CF02007016280800000A16FE016012017B04000004179A72DD02007016280800000A16FE016012017B04000004179A72F502007016280800000A16FE016012017B04000004179A722303007016280800000A16FE016012017B04000004179A723703007016280800000A16FE016012017B04000004179A725303007016280800000A16FE016012017B04000004179A726103007016280800000A16FE016012017B04000004179A726D03007016280800000A16FE016012017B04000004179A72A103007016280800000A16FE016012017B04000004179A72B303007016280800000A16FE01602C32120112017B04000004179A7D0A00000412017B040000048EB7193310120112017B04000004189A7D0C00000400381402000012017B04000004179A72FF00007016280800000A16408900000012017B040000048EB7183312120112017B04000004179A7D0C0000042B6500120172FF0000707D0600000412017B04000004189A72DB03007016280800000A163312120112017B04000004189A7D0C0000042B1100120112017B04000004189A7D0A0000040012017B040000048EB71A3310120112017B04000004199A7D0C0000040000387101000012017B04000004179A72F303007016280800000A16405701000012017B040000048EB7183315120112017B04000004179A7D0A000004383501000012017B040000048EB7193325120112017B04000004179A7D0A000004120112017B04000004189A7D0C000004380401000000120172C90000707D06000004120112017B04000004189A7D0900000412017B04000004199A72CB01007016280800000A16FE0112017B04000004199A720704007016280800000A16FE01602C15120112017B04000004199A7D0C00000438A000000012017B04000004199A729700007016280800000A16335B12017B040000048EB71A3312120112017B04000004199A7D0C0000042B3A00120172970000707D06000004120112017B040000041A9A7D0A00000412017B040000048EB71C3310120112017B040000041B9A7D0C00000400002B2E00120112017B04000004199A7D0A00000412017B040000048EB71B3310120112017B040000041A9A7D0C00000400000000120112017B03000004722704007012017B0C000004280900000A72590000706F0A00000A7D0B0000040000070A2B00062A3E0002036F0B00000A7D03000004002A420003027B030000046F0C00000A00002A000000133001001E0000000500001100027B03000004280D00000A28040000060B12017B070000040A2B00062A0000133001001E0000000600001100027B03000004280D00000A28040000060B12017B050000040A2B00062A0000133001001E0000000700001100027B03000004280D00000A28040000060B12017B060000040A2B00062A0000133001001E0000000800001100027B03000004280D00000A28040000060B12017B080000040A2B00062A0000133001001E0000000900001100027B03000004280D00000A28040000060B12017B090000040A2B00062A0000133001001E0000000A00001100027B03000004280D00000A28040000060B12017B0A0000040A2B00062A0000133004005C0000000B00001100027B03000004280D00000A28040000060B12017B0A000004725900007016280800000A16FE0116FE01027B03000004280D00000A28040000060C12027B0C000004725900007016280800000A16FE015F2D03162B01170A2B00062A133001001E0000000C00001100027B03000004280D00000A28040000060B12017B0B0000040A2B00062A0000133001001E0000000D00001100027B03000004280D00000A28040000060B12017B0C0000040A2B00062A00002602281100000A00002A000013300100120000000E000011000F00280C000006280D00000A0A2B00062A000013300100120000000F000011000F00280B000006280D00000A0A2B00062A0000133001001200000010000011000F00280F000006280D00000A0A2B00062A0000133001001200000011000011000F00280E000006280D00000A0A2B00062A0000133001001200000012000011000F00280A000006280D00000A0A2B00062A0000133001001200000013000011000F002809000006280D00000A0A2B00062A0000133001001200000014000011000F002807000006281200000A0A2B00062A000042534A4201000100000000000C00000076322E302E35303732370000000005006C0000009C050000237E000008060000B005000023537472696E677300000000B80B00002C04000023555300E40F0000100000002347554944000000F40F00007409000023426C6F620000000000000002000001571FA2030900000000FA0133001600000100000020000000030000000C000000170000000A0000000200000022000000010000001900000014000000010000000B0000000B00000003000000010000000300000000009F0501000000000006005B0054000E00860071000E00AB0090000E00450171000600610157010600750157010600500254000E00A30271000600B60254000600BD0254000A00EF02C8020E002D0390000E00490390000600500354000E00660390000E00790390000600A1038E030600BE038E034B00D203000006000104E10306002104E103060051043F0406007F046E040600C004A1040600CE04A1040600E20454000600F8043F04060013053F0406002E053F04060047053F04060060053F0406007D053F0400000000010000000000010001000921000029003400050001000100010000003F0034001D000D0010005180BC0013000100C2001F000100C90013000100D00022000100DA0013000100E10013000100EB0026000100F400130001000201130001000D01130001001A011300010021011300D020000000004602280129000100042100000000660B31012D0001001C210000000016083C013100010040210000000016004F0136000100F8280000000066036E013D00020008290000000066038201430003001C290000000006088A0149000400482900000000060895012900040074290000000006089E0129000400A029000000000608AA0129000400CC29000000000608BA0129000400F829000000000608C70129000400242A000000000608D6012D0004008C2A000000000608E70129000400B82A000000000608F00129000400E42A00000000061857025E000400F02A0000000016005D0262000400102B000000001600700262000500302B0000000016007C0262000600502B000000001600840262000700702B0000000016008C0262000800902B000000001600980262000900B02B000000001600AC0269000A00000001005501000001007301000001008801000001006B02000001006B02000001006B02000001006B02000001006B02000001006B02000001006B020200090002000D00110031012D0019006E013D00190082014300490028012900210031012D003900280129004900C2027F005900F9028600490007038D0049000E03930029001603290031008201A40021002103A90061005702C300710057025E00790057025E00390057025E00410021036502810057025E00890057025E0091005702C807A1005702CE07A90057025E00B1005702A400B9005702A400C1005702A400C9005702D307D1005702D307D9005702A400E1005702A400E9005702A400F1005702A400F9005702A40001015702A4000E00040016002000830018012E00B30083082E00BB008C082E00130167092E00AB007A082E00E300E8082E000B0134092E00CB00B8082E00D300BE082E00DB00B8082E00C300AB082E00EB00B8082E00F300EE082E00FB0016092E000301230943007300C9008000830018010002A300360320029B00700240029B00800560029B00440680029B00C004A0029B000407C0029B003B03E0029B00FE037000740078009900AF00B500B500B500B500B500BB00B500B5006002600260026002600260026B02020001000000F9014D0000000002510000000502560000000C025A00000011025A00000019025A00000025025A0000002E025A00000039024D00000046025A0000004B025A00020002000300020003000500020007000700020008000900020009000B0002000A000D0002000B000F0002000C00110002000D00130002000E00150002000F00170002000400030002000A00050002000C00070004800000010003000500030001000000D8079405000002000000000000000000000001000A00000000000800000000000000000000000A0013000000000002000000000000000000000001006500000000000000003C4D6F64756C653E006D73636F726C6962004D6963726F736F66742E56697375616C42617369630053514C4366674E6F64650053514C4367664E6F64650055736572446566696E656446756E6374696F6E730053797374656D0056616C7565547970650053797374656D2E446174610053797374656D2E446174612E53716C547970657300494E756C6C61626C65004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A65005F4E554C4C006D5F4E756C6C006D5F4E6F6465006D5F537472696E6773006D5F54797065006D5F53756254797065006D5F4C656E677468006D5F53514C496E7374616E6365006D5F4461746162617365006D5F436F6C6C656374696F6E006D5F50617468006D5F4974656D00546F537472696E67006765745F49734E756C6C006765745F4E756C6C0053716C537472696E6700506172736500730053797374656D2E494F0042696E617279526561646572005265616400720042696E6172795772697465720057726974650077006765745F4C656E677468006765745F54797065006765745F53756254797065006765745F53514C496E7374616E6365006765745F4461746162617365006765745F436F6C6C656374696F6E006765745F4973436F6C6C656374696F6E006765745F50617468006765745F4974656D0049734E756C6C004E756C6C004C656E677468005479706500537562547970650053514C496E7374616E636500446174616261736500436F6C6C656374696F6E004973436F6C6C656374696F6E0050617468004974656D004F626A656374002E63746F7200476574436F6C6C656374696F6E004E6F6465004765744461746162617365004765744974656D004765745061746800476574496E7374616E636500476574537562547970650053716C496E743332004765744C656E67746800537472696E6700436861720053706C6974004D6963726F736F66742E56697375616C42617369632E436F6D70696C65725365727669636573004F70657261746F727300436F6D70617265537472696E6700436F6E636174005265706C6163650052656164537472696E67006F705F496D706C696369740053716C55736572446566696E65645479706541747472696275746500466F726D61740053657269616C697A61626C654174747269627574650053716C4D6574686F644174747269627574650053716C46756E6374696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676765724E6F6E55736572436F64654174747269627574650044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053797374656D2E5265666C656374696F6E00417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E5265736F7572636573004E65757472616C5265736F75726365734C616E67756167654174747269627574650053797374656D2E52756E74696D652E496E7465726F705365727669636573004775696441747472696275746500436F6D56697369626C6541747472696275746500434C53436F6D706C69616E7441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C795469746C654174747269627574650053514C436C7565434C520053514C436C7565434C522E646C6C00000000094E0055004C004C00001D530051004C004300660067004D00650074006100640061007400610000114D006500740061006400610074006100001D530051004C004300660067002E007400530051004C004300660067000001000F4C006900630065006E0073006500002B530051004C004300660067002E0074005300650072007600690063006500420072006F006B0065007200001B5300650072007600690063006500420072006F006B00650072000015530051004C004300660067002E007400440062000011440061007400610062006100730065000023530051004C004300660067002E0074004A006F00620053006500720076006500720000134A006F0062005300650072007600650072000021530051004C004300660067002E00740049006E007300740061006E0063006500000D5300650072007600650072000025530051004C004300660067002E00740043006F006E006E0065006300740069006F006E00001543006F006E006E0065006300740069006F006E000021530051004C004300660067002E0074005300630068006500640075006C00650000115300630068006500640075006C0065000017530051004C0049006E007300740061006E0063006500001F4100630074006900760065004400690072006500630074006F0072007900001B43006F006E00660069006700750072006100740069006F006E00001F460075006C006C0054006500780074005300650072007600690063006500001749006E0066006F0072006D006100740069006F006E0000094D00610069006C000019500072006F00780079004100630063006F0075006E00740000215200650073006F00750072006300650047006F007600650072006E006F0072000011530065007400740069006E0067007300001B5400610072006700650074005300650072007600650072007300001B4200610063006B00750070004400650076006900630065007300000D4100750064006900740073000017430072006500640065006E007400690061006C007300002D430072007900700072006F006700720061007000680069006300500072006F00760069006400650072007300001345006E00640070006F0069006E0074007300001B4C0069006E006B00650064005300650072007600650072007300000D4C006F00670069006E007300000B52006F006C0065007300003353006500720076006500720041007500640069007400530070006500630069006600690063006100740069006F006E0073000011540072006900670067006500720073000027550073006500720044006500660069006E00650064004D006500730073006100670065007300001741006C00650072007400530079007300740065006D000013440061007400610062006100730065007300001F440061007400610062006100730065004F007000740069006F006E00730000037C0000000A039893428906459A5DF8F403F35B4C0008B77A5C561934E08908B03F5F7F11D50A3A02060E084E0055004C004C0002060203061D0E0206080320000E0320000204000011080600011108111105200101121505200101121903200008032800020408001108032800080328000E0320000106000111111108060001112111080307010E03070102060702110811080620011D0E1D03060003080E0E020500020E0E0E0520020E0E0E0A0705110811081D030E0E042001010E05000111110E0507020811080507020E110807070302110811080520010111354E010002000000040054020D4973427974654F7264657265640154020D497346697865644C656E6774680054080B4D61784279746553697A6500030000540E044E616D650A53514C4366674E6F646581460100040054020F497344657465726D696E697374696301540209497350726563697365015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373000000000407011111050001112108040701112180C4010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D650D476574436F6C6C656374696F6E040100000080C1010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D650A4765745375625479706580C0010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D65094765744C656E67746880BE010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D65074765745061746880C2010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D650B476574446174616261736580BE010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D65074765744974656D80C2010004005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E69737469630154020949735072656369736501540E044E616D650B476574496E7374616E636505200101114D0420010108042001010280A00024000004800000940000000602000000240000525341310004000001000100399F902A59B25D05A2415FEF2B54121D451200DA894C0265DC6EE75DA7E618C25B36A056E6E52EAF4C076E32497F4C3173C0E661AD4F90A9EBFE1849BB3C02FBBD3096098DEF03636CEF6DADDF9DFA290D810BA87F26A4C71DAD19921FD902F3462B084DAA51E763697B5B7094DA2FC4BA4B8A42E61A1D7CC8FD51834B21F1BB0801000301000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010C010007312E332E352E3300000501000000002901002462343736313261632D666636662D343034652D623536362D316132396533623733643236000005010001000027010022436F7079726967687420C2A92042696C6C2057756E64657220323030372D3230303900000C01000753514C436C756500001001000B42696C6C2057756E64657200003201002D53514C436C756520436F6E66696775726174696F6E204172636869766520434C5220496E746567726174696F6E0000090100044E6F646500000000006045000000000000000000007E4500000020000000000000000000000000000000000000000000007045000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000DFA8EB490000000002000000720000001C6000001C2A0000525344537FF0280BD6387541AB318EDD1D59FACE01000000433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C6F626A5C44656275675C53514C436C7565434C522E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030003000000280000800E000000480000801000000060000080000000000000000000000000000002000200000078000080030000009000008000000000000000000000000000000100007F0000A80000800000000000000000000000000000010001000000C00000800000000000000000000000000000010000000000D80000000000000000000000000000000000010000000000E80000000000000000000000000000000000010000000000F800000000000000000000000000000000000100000000000801000090840000E8020000000000000000000078870000280100000000000000000000A088000022000000000000000000000018810000780300000000000000000000780334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100030001000300050003000100030005003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004D8020000010053007400720069006E006700460069006C00650049006E0066006F000000B4020000010030003000300030003000340062003000000074002E00010043006F006D006D0065006E00740073000000530051004C0043006C0075006500200043006F006E00660069006700750072006100740069006F006E0020004100720063006800690076006500200043004C005200200049006E0074006500670072006100740069006F006E00000038000C00010043006F006D00700061006E0079004E0061006D00650000000000420069006C006C002000570075006E006400650072000000340005000100460069006C0065004400650073006300720069007000740069006F006E00000000004E006F006400650000000000300008000100460069006C006500560065007200730069006F006E000000000031002E0033002E0035002E003300000040000F00010049006E007400650072006E0061006C004E0061006D0065000000530051004C0043006C007500650043004C0052002E0064006C006C00000000006800220001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A9002000420069006C006C002000570075006E00640065007200200032003000300037002D003200300030003900000048000F0001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530051004C0043006C007500650043004C0052002E0064006C006C0000000000300008000100500072006F0064007500630074004E0061006D00650000000000530051004C0043006C00750065000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0033002E0035002E003300000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0033002E0035002E0033000000280000002000000040000000010004000000000080020000000000000000000000000000000000000000000000008000008000000080800080000000800080008080000080808000C0C0C0000000FF0000FF000000FFFF00FF000000FF00FF00FFFF0000FFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007777777777777777777777777777700444444444444444444444444444447004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF47004FFFFFFFFFFFFFFFFFFFFFFFFFFF4700488888888888888888888888888847004444444444444444444444444444470044C4C4C4C4C4C4C4C4C4ECECE49747004CCCCCCCCCCCCCCCCCCCCCCCCCCC40000444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC00000018000000180000001800000018000000180000001800000018000000180000001800000018000000180000001800000018000000180000001800000018000000180000001800000018000000180000001800000018000000180000003C0000007FFFFFFFFFFFFFFFFFFFFFFFF2800000010000000200000000100040000000000C0000000000000000000000000000000000000000000000000008000008000000080800080000000800080008080000080808000C0C0C0000000FF0000FF000000FFFF00FF000000FF00FF00FFFF0000FFFFFF000000000000000000077777777777777744444444444444474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF8474FFFFFFFFFFFF84748888888888888474CCCCCCCCCCCCC47C4444444444444C000000000000000000000000000000000FFFF000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000FFFF0000FFFF00000000010002002020100001000400E802000002001010100001000400280100000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000C000000903500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE';
   EXEC sp_executesql N'ALTER ASSEMBLY [SQLClueCLR]
ADD FILE FROM 0x4D6963726F736F667420432F432B2B204D534620372E30300D0A1A445300000000020000020000002B000000D8000000000000002A000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000C0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF3800000000F8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0BCA3101380000000010000000100000000000001100FFFF04000000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000942E3101E1A8EB49010000007FF0280BD6387541AB318EDD1D59FACE000000000000000001000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000BCA310138000000001000000010000000000000FFFFFFFF040000000380000000000000FFFFFFFF00000000FFFFFFFF00000000FFFFFFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B8D0123A6CC2D011B44200A0244A1DD2C4454B99E9E6D211903F00C04FA302A10B9D865A1166D311BD2A0000F80849BD60A66E40CF64824CB6F042D48172A7991000000000000000FE10A9CD41A6B4BD1C07DB7A291D807500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B8D0123A6CC2D011B44200A0244A1DD2C4454B99E9E6D211903F00C04FA302A10B9D865A1166D311BD2A0000F80849BD60A66E40CF64824CB6F042D48172A7991000000000000000AA1E8D378AB3AE832D0DB163F09A05C200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B8D0123A6CC2D011B44200A0244A1DD2C4454B99E9E6D211903F00C04FA302A10B9D865A1166D311BD2A0000F80849BD60A66E40CF64824CB6F042D48172A7991000000000000000C39412E48476783555476BCBE8F31AD200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B8D0123A6CC2D011B44200A0244A1DD2C4454B99E9E6D211903F00C04FA302A10B9D865A1166D311BD2A0000F80849BD60A66E40CF64824CB6F042D48172A79910000000000000003B85414835B83BE89E5616C1B4E19657000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000DD09000000000000DD090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FEEFFEEF01000000310200000031376431346635632D613333372D343937382D383238312D353334393333373863313037312E76620000433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C4D792050726F6A6563745C417373656D626C79496E666F2E766200633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C6D792070726F6A6563745C617373656D626C79696E666F2E766200433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C53514C4366674E6F64652E766200633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C73716C6366676E6F64652E766200433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C53514C4366674E6F646546756E6374696F6E732E766200633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C73716C6366676E6F646566756E6374696F6E732E7662000B000000000000002A0000000000000001000000000000002B0000008700000081010000E300000032010000D9010000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001BE23001040100001164912640C1C9010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000006000000010000002B0000000000000032010000280000001BE23001885C302258000000E30000002A0000003201000065000000000000000000000001000000280000001BE23001F3AA9CDE58000000010000002A0000000100000065000000000000000000000087000000280000001BE23001B0843976580000002B0000002A00000087000000650000000000000000000000D9010000280000001BE23001AB4540FE58000000810100002A000000D90100006500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000032002A1100000000640100000000000025000000000000000000000001000006000000000100000000546F537472696E670000001600031104000000600100002500000000000000010000001200241140463A53797374656D2E5465787400002200241140463A4D6963726F736F66742E53716C5365727665722E5365727665720000001A00241140463A53797374656D2E446174612E53716C5479706573000E00241140463A53797374656D0000000E0024112A53514C4367664E6F646500320024114050583A786D6C3D687474703A2F2F7777772E77332E6F72672F584D4C2F313939382F6E616D657370616365000000002A0024114050583A786D6C6E733D687474703A2F2F7777772E77332E6F72672F323030302F786D6C6E732F000A0024114050583A3D0000000E00241153514C4367664E6F646500001E00201100000000010000110000000000000000546F537472696E6700000000020006000200060032002A1100000000F4010000000000000C0000000000000000000000020000062500000001000000006765745F49734E756C6C001600031168010000F00100000C00000025000000010000000E0024112831303036363332393700000E0024114031303036363332393700001A0020110000000002000011000000000000000049734E756C6C0000020006000200060032002A11000000009C02000000000000170000000000000000000000030000063100000001000000006765745F4E756C6C00000016000311F8010000980200001700000031000000010000000E0024112831303036363332393700000E0024114031303036363332393700001600201100000000030000110000000000000000680000001A002011010000000300001100000000000000004E756C6C0000000002000600020006002E002A1100000000AC03000000000000AC0700000000000000000000040000064800000001000000005061727365000016000311A0020000A8030000AC07000048000000010000000E0024112831303036363332393700000E0024114031303036363332393700001A0020110000000004000011000000000000000050617273650000001600201101000000040000110000000000000000750000002200201102000000040000110000000000000400564224745F61727261792453300000002200201103000000040000110000000000000400564224745F737472696E67244C3000002200201104000000040000110000000000000400564224745F737472696E67244C31000002000600020006002E002A11000000001C040000000000000F000000000000000000000005000006F407000001000000005265616400000016000311B0030000180400000F000000F4070000010000000E0024112831303036363332393700000E00241140313030363633323937000002000600020006002E002A11000000008C0400000000000010000000000000000000000006000006030800000100000000577269746500001600031120040000880400001000000003080000010000000E0024112831303036363332393700000E002411403130303636333239370000020006000200060032002A110000000040050000000000001E0000000000000000000000070000061308000001000000006765745F4C656E6774680016000311900400003C0500001E00000013080000010000000E0024112831303036363332393700000E0024114031303036363332393700001A002011000000000500001100000000000000004C656E67746800002200201101000000050000110000000000000400564224745F7374727563742453300000020006000200060032002A1100000000F4050000000000001E0000000000000000000000080000063108000001000000006765745F547970650000001600031144050000F00500001E00000031080000010000000E0024112831303036363332393700000E0024114031303036363332393700001A0020110000000006000011000000000000000054797065000000002200201101000000060000110000000000000400564224745F7374727563742453300000020006000200060036002A1100000000AC060000000000001E0000000000000000000000090000064F08000001000000006765745F537562547970650000000016000311F8050000A80600001E0000004F080000010000000E0024112831303036363332393700000E0024114031303036363332393700001A0020110000000007000011000000000000000053756254797065002200201101000000070000110000000000000400564224745F737472756374245330000002000600020006003A002A11000000006C070000000000001E00000000000000000000000A0000066D08000001000000006765745F53514C496E7374616E63650000000016000311B0060000680700001E0000006D080000010000000E0024112831303036363332393700000E0024114031303036363332393700001E0020110000000008000011000000000000000053514C496E7374616E6365002200201101000000080000110000000000000400564224745F7374727563742453300000020006000200060036002A110000000028080000000000001E00000000000000000000000B0000068B08000001000000006765745F44617461626173650000001600031170070000240800001E0000008B080000010000000E0024112831303036363332393700000E0024114031303036363332393700001E002011000000000900001100000000000000004461746162617365000000002200201101000000090000110000000000000400564224745F7374727563742453300000020006000200060036002A1100000000E4080000000000001E00000000000000000000000C000006A908000001000000006765745F436F6C6C656374696F6E00160003112C080000E00800001E000000A9080000010000000E0024112831303036363332393700000E0024114031303036363332393700001E002011000000000A0000110000000000000000436F6C6C656374696F6E000022002011010000000A0000110000000000000400564224745F737472756374245330000002000600020006003A002A1100000000CC090000000000005C00000000000000000000000D000006C708000001000000006765745F4973436F6C6C656374696F6E00000016000311E8080000C80900005C000000C7080000010000000E0024112831303036363332393700000E00241140313030363633323937000022002011000000000B00001100000000000000004973436F6C6C656374696F6E0000000022002011010000000B0000110000000000000400564224745F737472756374245330000022002011020000000B0000110000000000000400564224745F7374727563742453310000020006000200060032002A1100000000800A0000000000001E00000000000000000000000E0000062309000001000000006765745F5061746800000016000311D00900007C0A00001E00000023090000010000000E0024112831303036363332393700000E0024114031303036363332393700001A002011000000000C0000110000000000000000506174680000000022002011010000000C0000110000000000000400564224745F7374727563742453300000020006000200060032002A1100000000340B0000000000001E00000000000000000000000F0000064109000001000000006765745F4974656D00000016000311840A0000300B00001E00000041090000010000000E0024112831303036363332393700000E0024114031303036363332393700001A002011000000000D00001100000000000000004974656D0000000022002011010000000D0000110000000000000400564224745F73747275637424533000000200060002000600F20000006C0000000000000001000100250000000000000007000000600000000000000026000080010000002700008009000000280000801300000029000080140000002A000080220000002B000080230000002C0000800500330009001A000D00190009000D000D00260009000F0005001100F20000003C00000025000000010001000C000000000000000300000030000000000000002F00008001000000300000800A0000003100008009000C000D001A0009001000F2000000540000003100000001000100170000000000000005000000480000000000000035000080010000003600008009000000370000801100000038000080150000003900008009000C00110031000D001C000D00150009001000F2000000D00500004800000001000100AC070000000000007A000000C4050000000000004000008001000000410000800A00000042000080150000004300008016000000440000801E000000450000803200000046000080520000004700008062000000480000806D000000EEEFFE808000000049000080810000004B0000808D0000004C0000809D0000004D000080A7000000EEEFFE80B80000004E000080B90000004F000080C500000050000080D100000051000080E2000000EEEFFE80F300000052000080F40000005300008000010000540000801001000055000080200100005600008035010000EEEFFE80460100005700008047010000580000805301000059000080630100005A000080730100005B00008088010000EEEFFE80990100005C0000809A0100005D000080A60100005E000080B60100005F000080C201000060000080D7010000EEEFFE80E801000061000080E901000062000080F5010000630000800502000064000080110200006500008026020000EEEFFE803702000066000080380200006700008044020000680000805402000069000080600200006A00008072020000EEEFFE80830200006B000080840200006C000080900200006D000080A00200006E000080AC0200006F000080BC02000070000080C202000071000080C302000072000080CF02000073000080DF02000075000080EB02000076000080F70200007700008003030000780000800F030000790000801B0300007A000080270300007B0000803C0300007C0000803D0300007E00008816040000880000802B0400008900008A34050000950000804405000096000080500500009700008060050000980000806605000099000080800500009B0000808C0500009C0000809E0500009D0000809F0500009F000080AB050000A0000080C2050000A1000080D4050000A2000080D5050000A3000080E5050000A4000080E6050000A5000080F2050000A600008002060000A700008003060000A800008009060000A900008023060000AB0000802F060000AC00008044060000AD00008050060000AF00008060060000B000008075060000B100008076060000B300008082060000B400008092060000B6000081C3060000B8000080D8060000B9000080EF060000BC000080FB060000BD0000800D070000BE0000800E070000C00000801A070000C10000802A070000C200008036070000C300008046070000C400008047070000C50000804A070000C60000804B070000C80000805B070000C900008067070000CA00008077070000CB00008078070000CC00008079070000CD0000807A070000CE0000807B070000CF000080A4070000D0000080A5070000D1000080A6070000D2000080AA070000D300008005004500090019000D00180009000F000D002D0009001E00090031000900280009002300010002000D002700110026001100300011002B000100020015002A0019002A001900300019002D000100020015003100190036001900390019003600190032000100020015002600190031001900390019003600190032000100020015002D00190032001900390019002A00190032000100020015002C0019002F001900390019002A00190032000100020015002E00190033001900390019002A00190032000100020015002C00190031001900390019002A001900320011001B000D001600110029001100310011002700110022001100240011001E0011001E0011002F0015002E001100150015003D00190032001500430019003800190037001D00360019001F0015003D00190037001D00360019001D001D0036001D00430021003A001D002100210040001D0023001D003B0021003A001D00230019001F0015003D00190037001D003C0019003B001D003C001D00360019001D001D0035001D003A001D00470021003A001D00490021003F0025003E00210025002500420025004400250043002900420025002B00210027001D0021002100400021003F0025003E00210027001D00230019001F0015001B001500440011001700090013000900110005001100F20000003C000000F4070000010001000F00000000000000030000003000000000000000D500008001000000D70000800D000000D80000800500370009001E0005000C00F20000003C00000003080000010001001000000000000000030000003000000000000000DA00008001000000DC0000800E000000DD000080050038000900180005000C00F20000003C00000013080000010001001E00000000000000030000003000000000000000E000008001000000E10000801C000000E200008009000C000D002C0009001000F20000003C00000031080000010001001E00000000000000030000003000000000000000E600008001000000E70000801C000000E800008009000C000D002A0009001000F20000003C0000004F080000010001001E00000000000000030000003000000000000000EC00008001000000EE0000801C000000EF00008009000C000D002D0009001000F20000003C0000006D080000010001001E00000000000000030000003000000000000000F300008001000000F40000801C000000F500008009000C000D00310009001000F20000003C0000008B080000010001001E00000000000000030000003000000000000000F900008001000000FA0000801C000000FB00008009000C000D002E0009001000F20000003C000000A9080000010001001E00000000000000030000003000000000000000FF00008001000000000100801C0000000101008009000C000D00300009001000F20000003C000000C7080000010001005C000000000000000300000030000000000000000501008001000000060100805A0000000701008009000C000D006C0009001000F20000003C00000023090000010001001E000000000000000300000030000000000000000B010080010000000C0100801C0000000D01008009000C000D002A0009001000F20000003C00000041090000010001001E000000000000000300000030000000000000001101008001000000120100801C0000001301008009000C000D002A0009001000F400000008000000E300000000000000780000000000000018000000300000004C000000640000007C00000094000000A8000000C0000000D4000000EC0000000001000018010000340100004C010000640100007C01000098010000B0010000D0010000E8010000040200001C0200003C02000054020000740200008C020000A4020000BC020000D4020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000036002A11000000009C01000000000000120000000000000000000000110000065F0900000100000000476574436F6C6C656374696F6E0000160003110400000098010000120000005F090000010000000E0024112831303036363332393700002200241140463A4D6963726F736F66742E53716C5365727665722E5365727665720000001A00241140463A53797374656D2E446174612E53716C5479706573001E00241140463A53797374656D2E446174612E53716C436C69656E74000000001200241140463A53797374656D2E4461746100000E00241140463A53797374656D0000000E0024112A53514C4367664E6F646500320024114050583A786D6C3D687474703A2F2F7777772E77332E6F72672F584D4C2F313939382F6E616D657370616365000000002A0024114050583A786D6C6E733D687474703A2F2F7777772E77332E6F72672F323030302F786D6C6E732F000A0024114050583A3D0000000E00241153514C4367664E6F6465000022002011000000000E0000110000000000000000476574436F6C6C656374696F6E000000020006000200060036002A110000000034020000000000001200000000000000000000001200000671090000010000000047657444617461626173650000000016000311A0010000300200001200000071090000010000000E0024112831303036363332393700000E0024114031303036363333313300001E002011000000000F0000110000000000000000476574446174616261736500020006000200060032002A1100000000C402000000000000120000000000000000000000130000068309000001000000004765744974656D000000001600031138020000C00200001200000083090000010000000E0024112831303036363332393700000E0024114031303036363333313300001A002011000000001000001100000000000000004765744974656D00020006000200060032002A1100000000540300000000000012000000000000000000000014000006950900000100000000476574506174680000000016000311C8020000500300001200000095090000010000000E0024112831303036363332393700000E0024114031303036363333313300001A002011000000001100001100000000000000004765745061746800020006000200060036002A1100000000EC0300000000000012000000000000000000000015000006A70900000100000000476574496E7374616E6365000000001600031158030000E803000012000000A7090000010000000E0024112831303036363332393700000E0024114031303036363333313300001E00201100000000120000110000000000000000476574496E7374616E636500020006000200060032002A1100000000800400000000000012000000000000000000000016000006B90900000100000000476574537562547970650016000311F00300007C04000012000000B9090000010000000E0024112831303036363332393700000E0024114031303036363333313300001E00201100000000130000110000000000000000476574537562547970650000020006000200060032002A1100000000140500000000000012000000000000000000000017000006CB09000001000000004765744C656E677468000016000311840400001005000012000000CB090000010000000E0024112831303036363332393700000E0024114031303036363333313300001E002011000000001400001100000000000000004765744C656E6774680000000200060002000600F20000003C0000005F09000001000100120000000000000003000000300000000000000012000080010000001400008010000000150000800500500009001F0005001100F20000003C000000710900000100010012000000000000000300000030000000000000001B000080010000001D000080100000001E00008005004E0009001D0005001100F20000003C00000083090000010001001200000000000000030000003000000000000000240000800100000026000080100000002700008005004A000900190005001100F20000003C000000950900000100010012000000000000000300000030000000000000002D000080010000002F000080100000003000008005004A000900190005001100F20000003C000000A7090000010001001200000000000000030000003000000000000000360000800100000038000080100000003900008005004E000900200005001100F20000003C000000B90900000100010012000000000000000300000030000000000000003F0000800100000041000080100000004200008005004D0009001C0005001100F20000003C000000CB09000001000100120000000000000003000000300000000000000048000080010000004A000080100000004B00008005004B0009001B0005001100F400000008000000810100000000000038000000EC02000008030000200300003C030000540300006C030000840300009C030000B4030000D0030000E8030000040400001C04000034040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFF1A092FF160010000B40200004D0000000100000005020000010000003D03000001000000E9010000010000001D020000010000007D000000010000003D020000010000006D030000010000004D01000001000000010000000100000021030000010000001900000001000000D10100000100000009030000010000000101000001000000D50200000100000065000000010000000504000001000000350100000100000035040000010000001D04000001000000BD02000001000000A90000000100000075020000010000009D03000001000000D500000001000000A502000001000000190100000100000031000000010000008D02000001000000D1030000010000005503000001000000B50300000100000055020000010000006501000001000000ED020000010000009901000001000000ED000000010000009500000001000000E903000001000000C1000000010000007D01000001000000B1010000010000008503000001000000010400000200000000000000000002000000000000000000000200000000000001040000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000820000000000000000010400000200000000000000000000000000000000000000000000000000000001040200020000000000000000000000000000000000000000000000000000000100000002000088000000000000000000000000000000000000000000000000010400000200000000000000000000000000000000000000000000000000000001842400020000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000040000000000000000000002000000000000000000000000004000000000000000000000000000000000000200000000000000000000000000000800000000000000000000000000000000200000000000000000080000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000008000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000C0000001800000024000000300000003C0000004800000054000000600000006C0000007800000084000000900000009C000000A8000000B4000000C0000000CC000000D8000000E4000000F0000000FC0000000801000014010000200100002C0100003801000044010000500100005C0100006801000074010000800100008C01000098010000A4010000B0010000BC010000C8010000D4010000E0010000EC010000F80100000402000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001600251100000000040000000100546F537472696E6700001600291100000000040000000100303630303030303100001A002511000000006801000001006765745F49734E756C6C000000001600291100000000680100000100303630303030303200001600251100000000F801000001006765745F4E756C6C00001600291100000000F80100000100303630303030303300001200251100000000A002000001005061727365001600291100000000A00200000100303630303030303400001200251100000000B003000001005265616400001600291100000000B003000001003036303030303035000012002511000000002004000001005772697465001600291100000000200400000100303630303030303600001A002511000000009004000001006765745F4C656E6774680000000016002911000000009004000001003036303030303037000016002511000000004405000001006765745F5479706500001600291100000000440500000100303630303030303800001A00251100000000F805000001006765745F537562547970650000001600291100000000F80500000100303630303030303900001E00251100000000B006000001006765745F53514C496E7374616E63650000001600291100000000B00600000100303630303030306100001A002511000000007007000001006765745F44617461626110000000000000000000000000000000000000000000000001000000FFFFFFFF1A092FF10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000736500001600291100000000700700000100303630303030306200001E002511000000002C08000001006765745F436F6C6C656374696F6E0000000016002911000000002C0800000100303630303030306300001E00251100000000E808000001006765745F4973436F6C6C656374696F6E00001600291100000000E80800000100303630303030306400001600251100000000D009000001006765745F5061746800001600291100000000D00900000100303630303030306500001600251100000000840A000001006765745F4974656D00001600291100000000840A00000100303630303030306600001A00251100000000040000000200476574436F6C6C656374696F6E001600291100000000040000000200303630303030313100001A00251100000000A0010000020047657444617461626173650000001600291100000000A001000002003036303030303132000016002511000000003802000002004765744974656D0000001600291100000000380200000200303630303030313300001600251100000000C80200000200476574506174680000001600291100000000C80200000200303630303030313400001A00251100000000580300000200476574496E7374616E63650000001600291100000000580300000200303630303030313500001A00251100000000F0030000020047657453756254797065000000001600291100000000F003000002003036303030303136000016002511000000008404000002004765744C656E6774680016002911000000008404000002003036303030303137000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFF77093101010000000E0000880F0027C61000ED0BCC0000006C0200002C000000BC000000000000000000000016000000190000000000EEC00000000000000000FFFF000000000000FFFFFFFF00000000FFFF0000000000000000000000000C00380B000000000000E809000001000000C8E32C1F000000000000000053514C4367664E6F64652E53514C4366674E6F6465004243363831413235000000000000FFFF000000000000FFFFFFFF00000000FFFF0000000000000000000000000D001805000000000000EC01000001000000D8E32C1F000000000000000053514C4367664E6F64652E55736572446566696E656446756E6374696F6E73003231303734413046000000002DBA2EF10100696E00000000250000000000000000007372000000000000000001006F63250000000C0000000000000000003764000000000000000001002D3431000000170000000000000000003337000000000000000001002F7348000000AC070000000000000000657200000000000000000100756DF40700000F0000000000000000007564000000000000000001006F6A0308000010000000000000000000636F000000000000000001006976130800001E000000000000000000732F00000000000000000100696C310800001E00000000000000000073750000000000000000010032304F0800001E0000000000000000006C63000000000000000001006E5C6D0800001E00000000000000000072630000000000000000010075738B0800001E000000000000000000656E000000000000000001007374A90800001E0000000000000000006563000000000000000001005C63C70800005C0000000000000000006365000000000000000001002F66230900001E000000000000000000626900000000000000000100732F410900001E000000000000000000646F0000000000000000010074735F09000012000000000000000100203200000000000000000100747371090000120000000000000001006F6E000000000000000001006E748309000012000000000000000100657300000000000000000100626995090000120000000000000001006973000000000000000001002032A709000012000000000000000100716C000000000000000001006F6EB9090000120000000000000001007662000000000000000001007375CB090000120000000000000001005C700000000000000000020002000D01000000000100FFFFFFFF00000000DD0900000802000000000000FFFFFFFF00000000FFFFFFFF020002000000010001000100000000004F000000433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C53514C4366674E6F64652E766200433A5C55736572735C62696C6C5C446F63756D656E74735C56697375616C2053747564696F20323030385C50726F6A656374735C53514C436C75655C4E6F64655C53514C4366674E6F646546756E6374696F6E732E76620000FEEFFEEF010000000100000000010000000000000000000000FFFFFFFFFFFFFFFFFFFF0B00FFFFFFFFFFFFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000942E3101E1A8EB49010000007FF0280BD6387541AB318EDD1D59FACE7A0100002F4C696E6B496E666F002F6E616D6573002F7372632F686561646572626C6F636B002F7372632F66696C65732F31376431346635632D613333372D343937382D383238312D353334393333373863313037312E7662002F7372632F66696C65732F633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C6D792070726F6A6563745C617373656D626C79696E666F2E7662002F7372632F66696C65732F633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C73716C6366676E6F64652E7662002F7372632F66696C65732F633A5C75736572735C62696C6C5C646F63756D656E74735C76697375616C2073747564696F20323030385C70726F6A656374735C73716C636C75655C6E6F64655C73716C6366676E6F646566756E6374696F6E732E766200070000000E00000001000000E00F0000000000000A00000005000000BD000000090000000000000004000000170100000A00000011000000060000005600000008000000220000000700000000000000000000000000000000000000000000000000000000001100000018000000EA010000380000008F04000000000000710200000401000058000000580000005800000058000000280000009C15000040070000240400002C0000004C0400000300000028000000060000002500000026000000270000000C0000000D0000000E0000000700000008000000090000000A0000000B0000000F000000100000001100000012000000130000001400000015000000160000001700000018000000190000001A0000001B0000001C0000001D0000001E0000001F000000200000002200000021000000230000002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
AS N''SQLClueCLR.pdb''';
  END

GO

-- IF  NOT EXISTS (SELECT * FROM [sys].[assemblies] WHERE [name] = N'SQLClueCLR')
--  BEGIN
--  EXEC sp_executesql N'CREATE ASSEMBLY [SQLClueCLR]
--AUTHORIZATION [dbo]
--FROM ''   path here \SQLClueCLR.dll''
--WITH PERMISSION_SET = SAFE';
--   EXEC sp_executesql N'ALTER ASSEMBLY [SQLClueCLR]
--ADD FILE FROM '' path here   \SQLClueCLR.pdb''';
--  END

GO

 IF EXISTS (SELECT * FROM [sys].[fn_listextendedproperty] (N'AutoDeployed'
                                                          ,  N'ASSEMBLY'
                                                          , 'SQLClueCLR'
                                                          , NULL
                                                          , NULL
                                                          , NULL
                                                          , NULL))
   EXEC [sys].[sp_dropextendedproperty] 
       @name=N'AutoDeployed'
     , @level0type=N'ASSEMBLY'
     , @level0name=N'SQLClueCLR';

 EXEC [sys].[sp_addextendedproperty] 
   @name=N'AutoDeployed'
 , @value=N'no'
 , @level0type=N'ASSEMBLY'
 , @level0name=N'SQLClueCLR';

 IF EXISTS (SELECT * FROM [sys].[fn_listextendedproperty] (N'SqlAssemblyProjectRoot'
                                                          ,  N'ASSEMBLY'
                                                          , 'SQLClueCLR'
                                                          , NULL
                                                          , NULL
                                                          , NULL
                                                          , NULL))
   EXEC [sys].[sp_dropextendedproperty] 
       @name=N'SqlAssemblyProjectRoot'
     , @level0type=N'ASSEMBLY'
     , @level0name=N'SQLClueCLR';

 EXEC [sys].[sp_addextendedproperty] 
   @name=N'SqlAssemblyProjectRoot'
 , @value=N'..\Visual Studio 2008\Projects\SQLClue\SQLCfgNode' 
 , @level0type=N'ASSEMBLY'
 , @level0name=N'SQLClueCLR';

 IF TYPE_ID('SQLCfg.SQLCfgNode') IS NULL
  BEGIN
   EXEC [dbo].[sp_executesql] N'CREATE TYPE [SQLCfg].[SQLCfgNode] EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.SQLCfgNode]'

   EXEC [sys].[sp_addextendedproperty] 
         @name=N'AutoDeployed'
    , @value=N'no' 
    , @level0type=N'SCHEMA'
    , @level0name=N'SQLCfg'
    , @level1type=N'TYPE'
    , @level1name=N'SQLCfgNode';

   EXEC [sys].[sp_addextendedproperty] 
      @name=N'SqlAssemblyFile'
    , @value=N'SQLCfgNode.vb' 
    , @level0type=N'SCHEMA'
    , @level0name=N'SQLCfg'
    , @level1type=N'TYPE'
    , @level1name=N'SQLCfgNode';

   EXEC [sys].[sp_addextendedproperty] 
      @name=N'SqlAssemblyFileLine'
    , @value=13 
    , @level0type=N'SCHEMA'
    , @level0name=N'SQLCfg'
    , @level1type=N'TYPE'
    , @level1name=N'SQLCfgNode';
 
  END

GO

IF  NOT EXISTS (SELECT * FROM [sys].[objects] 
                WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetCollection]') 
                AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetCollection](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetCollection]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetCollection'
 
  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetCollection'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetCollection'
 END

GO

IF NOT EXISTS (SELECT * FROM [sys].[objects] 
               WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetDatabase]') 
               AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetDatabase](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetDatabase]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetDatabase'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetDatabase'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetDatabase'

 END

GO
IF NOT EXISTS (SELECT * FROM [sys].[objects] 
               WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetInstance]') 
               AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetInstance](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetInstance]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetInstance'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetInstance'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetInstance'

 END

GO

IF  EXISTS (SELECT * FROM [sys].[objects] 
            WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetItem]') 
            AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetItem](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](4000) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetItem]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetItem'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetItem'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetItem'

 END
 
GO

IF  EXISTS (SELECT * FROM [sys].[objects] 
            WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetLength]') 
            AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetLength](@Node [SQLCfg].[SQLCfgNode])
RETURNS [int] WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetLength]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetLength'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetLength'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetLength'

 END

GO

IF  EXISTS (SELECT * FROM [sys].[objects] 
            WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetPath]') 
            AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetPath](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetPath]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetPath'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetPath'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetPath'

 END

GO

IF  EXISTS (SELECT * FROM [sys].[objects] 
            WHERE [object_id] = OBJECT_ID(N'[SQLCfg].[GetSubType]') 
            AND [type] in (N'FN', N'IF', N'TF', N'FS', N'FT'))
 BEGIN
  EXEC sp_executesql 
N'CREATE FUNCTION [SQLCfg].[GetSubType](@Node [SQLCfg].[SQLCfgNode])
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [SQLClueCLR].[SQLCgfNode.UserDefinedFunctions].[GetSubType]'

  EXEC sys.sp_addextendedproperty 
     @name=N'AutoDeployed'
   , @value=N'no' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetSubType'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFile'
   , @value=N'SQLCfgNodeFunctions.vb' 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetSubType'

  EXEC sys.sp_addextendedproperty 
     @name=N'SqlAssemblyFileLine'
   , @value=18 
   , @level0type=N'SCHEMA'
   , @level0name=N'SQLCfg'
   , @level1type=N'FUNCTION'
   , @level1name=N'GetSubType'

 END

GO


/******* start refresh from instSQLConfiguration.sql ******/ 

IF OBJECT_ID('[SQLCfg].[tChange]','U') IS NULL
 BEGIN
  CREATE TABLE [SQLCfg].[tChange] (
     [Id] [INT] IDENTITY (1, 1) NOT NULL 
   , [Node]  [SQLCfg].[SQLCfgNode] NOT NULL
   , [Version] [INT] NULL 
   , [Action] [NVARCHAR] (30) NOT NULL
   , [EventData] [XML] SPARSE NULL  
   , [Definition] [NVARCHAR] (MAX) NULL
   , [DefinitionDt] [DATETIME] SPARSE NULL
   , [RecCreatedDt] [DATETIME] NOT NULL 
     CONSTRAINT [dft_tChange__RecCreatedDt] 
     DEFAULT (CURRENT_TIMESTAMP)
   , CONSTRAINT [pkc_tChange__Id] 
     PRIMARY KEY CLUSTERED ([Id]));

  CREATE NONCLUSTERED INDEX [ixn_tChange_Node_i]
  ON [SQLCfg].[tChange] ([Node])
  INCLUDE ([Version], [Id])

  CREATE UNIQUE NONCLUSTERED INDEX [ixn_tChange_Version_i]  
  ON [SQLCfg].[tChange] ([Version], [Node])
  INCLUDE ([Id], [Action])
  
  CREATE NONCLUSTERED INDEX [ixn_tChange_RecCreatedDt_i]
  ON [SQLCfg].[tChange] ([RecCreatedDt])
  INCLUDE ([Node],[Action])
  
 END

/******* end refresh from instSQLConfiguration.sql ******/ 
GO

SET IDENTITY_INSERT [SQLCfg].[tChange] ON

GO

  DECLARE @FinalRowCount [INT]
  INSERT [SQLCfg].[tChange]
  ( [Id]
  , [Node]
  , [Version]
  , [Action]
  , [EventData]
  , [Definition]
  , [DefinitionDt]
  , [RecCreatedDt] )
 SELECT 
    [Id]
  , [Node]
  , [Version]
  , [Action]
  , [EventData]
  , [Definition]
  , [DefinitionDt]
  , [RecCreatedDt]
 FROM [SQLCfg].[tempChange];
 SET @FinalRowCount = @@ROWCOUNT;

 -- verify the copy operation
 IF (SELECT [RowCount] FROM [SQLCfg].[Starting_tChange_rowcount]) <> @FinalRowCount 
   RAISERROR('Refresh of SQLClueCLR assembly failed the rowcount check while reloading the table data from the holding table.',16,1);

GO

SET IDENTITY_INSERT [SQLCfg].[tChange] OFF

GO

-- reset identity if needed
DBCC CHECKIDENT ('[SQLCfg].[tChange]')

GO

DROP TABLE [SQLCfg].[Starting_tChange_rowcount]

GO

ALTER TABLE [SQLCfg].[tChangeLabel] 
ADD CONSTRAINT [fk_tChangeLabel__ChangeId__to__tChange]
FOREIGN KEY (ChangeId) REFERENCES [SQLCfg].[tChange] (Id)

/******* start refresh from instSQLConfiguration.sql ******/ 

GO
/******************************************************************************
**    Auth: Bill Wunder
**    Date: April 1, 2007
**
*******************************************************************************
**    Change History
*******************************************************************************
**    Date           Author             Description of Change
**              
*******************************************************************************/

CREATE TRIGGER [SQLCfg].[trgtSQLCfg_Insert_Update_Delete]
ON [SQLCfg].[tSQLCfg]
FOR INSERT, UPDATE, DELETE
AS
BEGIN

 DECLARE @icount [INT]
  , @dcount [INT]
  , @ucount [INT]
  , @Node  [SQLCfgNode] 
  , @TextData [VARCHAR] (2048);

 SET NOCOUNT ON;

 BEGIN TRY

  SELECT @icount = COUNT(*) FROM [inserted];
  SELECT @dcount = COUNT(*) FROM [deleted];
  SELECT @ucount = COUNT(*) FROM [SQLCfg].[tSQLCfg];

  -- no multi row
  IF @icount > 1 OR @dcount > 1
   BEGIN
    SET @TextData = 'Multi-row [SQLCfg].[tSQLCfg] operations are not permitted';
    RAISERROR (@TextData, 16,1);
   END

  -- only one row in table
  IF @ucount > 1
   BEGIN
    SET @TextData = 'Cannot add multiple [SQLCfg].[tSQLCfg] configurations';
    RAISERROR (@TextData, 16,1);
   END

  -- no delete
  IF @dcount = 1 and @icount = 0 
   BEGIN
    SET @TextData = 'Cannot remove the [SQLCfg].[tSQLCfg] configuration';
    RAISERROR (@TextData, 16,1);
   END

  SET @Node = 'SQLCfgMetadata|SQLCfg.tSQLCfg';

  -- update
  IF @dcount = 1 and @icount = 1
   BEGIN

    -- add audit info
    UPDATE [SQLCfg].[tSQLCfg]
    SET [RecUpdatedDt] = CURRENT_TIMESTAMP
     , [RecUpdatedUser] = ORIGINAL_LOGIN();

    -- record the update to change
    INSERT [SQLCfg].[tChange]
     ( [Node]  
     , [Version]
     , [Action] 
     , [Definition]
     , [DefinitionDt] )
    SELECT 
       @Node
     , [SQLCfg].[fLastVersion](@Node) + 1
     , 'Modify'
     , 'UPDATE [SQLCfg].[tSQLCfg]
SET [LicensedCompany] = ''' + i.[LicensedCompany] + '''
 , [LicensedUser] = ''' + i.[LicensedUser] + '''
 , [LicenseCode] = ''' + i.[LicenseCode] + '''
 , [LicensedInstanceCount] = ' + CAST(i.[LicensedInstanceCount] AS [VARCHAR] (10)) + '
 , [LicenseDate] = ''' + i.[LicenseDate] + '''
 , [RecCreatedDt] = ''' + CAST(i.[RecCreatedDt] AS [VARCHAR] (20)) + '''
 , [RecCreatedUser] = ''' + i.[RecCreatedUser] + '''
 , [RecUpdatedDt] = ''' + CAST(i.[RecUpdatedDt] AS [VARCHAR] (20)) + '''
 , [RecUpdatedUser] = ''' + i.[RecUpdatedUser] + '''
WHERE [LicensedCompany] = ''' + d.[LicensedCompany] + '''
AND [LicensedUser] = ''' + d.[LicensedUser] + '''
AND [LicenseCode] = ''' + d.[LicenseCode] + '''
AND [LicensedInstanceCount] = ' + CAST(d.[LicensedInstanceCount] AS [VARCHAR] (10)) + '
AND [LicenseDate] = ''' + d.[LicenseDate] + '''
AND [RecCreatedDt] = ''' + CAST(d.[RecCreatedDt] AS [VARCHAR] (20)) + '''
AND [RecCreatedUser] = ''' + d.[RecCreatedUser] + '''
AND [RecUpdatedDt] = ''' + CAST(d.[RecUpdatedDt] AS [VARCHAR] (20)) + '''
AND [RecUpdatedUser] = ''' + d.[RecUpdatedUser] + '''
AND ORIGINAL_LOGIN() = ''' + ORIGINAL_LOGIN() + ''''
     , CURRENT_TIMESTAMP
    FROM [inserted] i
    CROSS JOIN [deleted] d;

   END;      

  -- insert
  IF @dcount = 0 and @icount = 1
   BEGIN
    -- log the insert to change
    INSERT [SQLCfg].[tChange]
     ( [Node]  
     , [Version]
     , [Action] 
     , [Definition]
     , [DefinitionDt] )
    SELECT 
       @Node
     , [SQLCfg].[fLastVersion](@Node) + 1
     , 'Include'
     , 'INSERT [SQLCfg].[tSQLCfg]
 ( [LicensedCompany] 
 , [LicensedUser] 
 , [LicenseCode]
 , [LicensedInstanceCount]
 , [LicenseDate] 
 , [RecCreatedDt] 
 , [RecCreatedUser] 
 , [RecUpdatedDt] 
 , [RecUpdatedUser] )
SELECT ''' + i.[LicensedCompany] + '''
 , ''' + i.[LicensedUser] + '''
 , ''' + i.[LicenseCode] + '''
 , ' + CAST(i.[LicensedInstanceCount] AS [VARCHAR] (10)) + '
 , ''' + i.[LicenseDate] + '''
 , ''' + CAST(i.[RecCreatedDt] AS [VARCHAR] (20)) + '''
 , ''' + i.[RecCreatedUser] + '''
 , ''' + CAST(i.[RecUpdatedDt] AS [VARCHAR] (20)) + '''
 , ''' + i.[RecUpdatedUser] + ''''
     , CURRENT_TIMESTAMP
    FROM [inserted] i;

   END;

 END TRY 

 BEGIN CATCH

  EXEC [SQLCfg].[pLogSQLError] @TextData, @@PROCID;

 END CATCH 

END;

GO 
/******************************************************************************
**    Auth: Bill Wunder
**    Date: April 1, 2007
**
**    Desc: get the last inserted version for a specified node 
**
*******************************************************************************
**    Change History
*******************************************************************************
**    Date           Author             Description of Change
**              
*******************************************************************************/

CREATE FUNCTION [SQLCfg].[fLastVersion] 
( @Node  [SQLCfgNode] )
RETURNS [INT]
AS
BEGIN
 DECLARE @LastVersion [INT];
 SET @LastVersion = ISNULL( ( SELECT MAX(ISNULL([Version],0))
                              FROM [SQLCfg].[tChange]
                              WHERE [Node] = @Node), 0);
 RETURN @LastVersion;
END

GO
/******************************************************************************
**    Auth: Bill Wunder
**    Date: April 1, 2007
**
**    Desc: associate the current versions at a specific time of all item 
**       Optionally, inclued the definitions for all children of the  
**       specified configuration hierarcy. Primary use case will be to label
**       and instance or database hierarchy 
** Note: NULL label text may be valid, even IF bad style. In this case the label
**       would include a reference to the current user and system time 
**
*******************************************************************************
**    Change History
*******************************************************************************
**    Date           Author             Description of Change
**              
*******************************************************************************/

CREATE PROCEDURE [SQLCfg].[pChangeApplyLabel] 
 ( @ChangeId [INT]
 , @IncludeChildren [BIT] = 1
 , @Label [NVARCHAR] (MAX) = NULL 
 , @Notes [NVARCHAR] (MAX) = NULL
 , @LabelVersionDate [DATETIME] = NULL
 , @DBPrincipal [NVARCHAR] (128) = 'dbo' )
AS
BEGIN
 DECLARE @LabelId [INT]
  , @RootNode [SQLCfgNode]
  , @LabeledChangeId [INT]
  , @ApLockResource [NVARCHAR] (255)
  , @ApLockMode [NVARCHAR] (32)
  , @ApLockOwner [NVARCHAR] (32)
  , @rc [INT]
  , @rrc [INT]
  , @TextData [NVARCHAR] (MAX);

 SET XACT_ABORT ON;
 SET NOCOUNT ON;

 BEGIN TRY

  IF @Label IS NULL 
   SET @LABEL = 'labeled on ' + convert([VARCHAR] (30), CURRENT_TIMESTAMP, 121) + ' by ' + ORIGINAL_LOGIN();

   BEGIN TRAN
    
     -- if a LabelVersionDate has been provided, get the id of the version of the Change node for that date
     -- if no LabelVersionDate provided then label the most recent version(s) 
     SELECT @LabeledChangeId = [Id]
      , @RootNode = [Node] 
     FROM [SQLCfg].[tChange]
     WHERE [Id] = (SELECT CASE WHEN @LabelVersionDate IS NULL THEN MAX([Id]) ELSE MIN([Id]) END 
                   FROM [SQLCfg].[tChange] 
                   WHERE [Node] = (SELECT [Node] 
                                   FROM [SQLCfg].[tChange]
                                   WHERE [Id] = @ChangeId
                                   AND [RecCreatedDt] > ISNULL(@LabelVersionDate,0)));

     -- create the label
     INSERT [SQLCfg].[tLabel] 
      ( [IncludeChildren]
      , [Label]
      , [Notes])
     VALUES( @IncludeChildren
      , ISNULL(@Label, 'labeled on ' + CONVERT([VARCHAR] (21), CURRENT_TIMESTAMP, 101) + ' by ' + ORIGINAL_LOGIN())
      , @Notes);

     SET @LabelId = SCOPE_IDENTITY();

     -- add the labe
     INSERT [SQLCfg].[tChangeLabel] ([LabelId], [ChangeId])
     SELECT @LabelId 
      , CASE WHEN @LabelVersionDate IS NULL THEN MAX([Id]) ELSE MIN([Id]) END 
     FROM [SQLCfg].[tChange]
     WHERE CHARINDEX(@RootNode.ToString(), [Node].ToString()) = 1
     AND (@IncludeChildren = 1 OR [Id] = @LabeledChangeId)
     AND [RecCreatedDt] > ISNULL(@LabelVersionDate,0)
     GROUP BY [Node];

   COMMIT TRAN;
  END TRY

  BEGIN CATCH

   SET @TextData = '   @ChangeId = ' + ISNULL(CAST(@ChangeId AS [VARCHAR] (10)),'NULL') + CHAR(13) + CHAR(10)
                 + ' , @IncludeChildren = ' + ISNULL(CAST(@IncludeChildren AS [VARCHAR] (6)),'NULL') + CHAR(13) + CHAR(10)
                 + ' , @Label = ' + ISNULL(CHAR(39) + @Label + CHAR(39),'NULL') + CHAR(13) + CHAR(10)
                 + ' , @Notes = <varchar(max)>' + CHAR(13) + CHAR(10)
                 + ' , @LabelVersionDate = ' + ISNULL(CHAR(39) + CAST(@LabelVersionDate AS VARCHAR(20)) + CHAR(39),'NULL');
   EXEC [SQLCfg].[pLogSQLError] @TextData, @@PROCID;

 END CATCH;

END
GO

GRANT EXECUTE ON [SQLCfg].[pChangeApplyLabel] TO [SQLCfgAdminRole];

GO
/******* end refresh from instSQLConfiguration.sql ******/ 

IF OBJECT_ID('[SQLCfg].[tempChange]') IS NOT NULL
AND (SELECT COUNT(*) FROM [SQLCfg].[tChange]) = (SELECT COUNT(*) FROM [SQLCfg].[tempChange]) 
 DROP TABLE [SQLCfg].[tempChange]

GO

BEGIN TRY
 DECLARE @SetMultiUser as [NVARCHAR] (500);
 SET @SetMultiUser = 'ALTER DATABASE [' + DB_NAME() + '] SET MULTI_USER;';
 EXEC [dbo].[sp_executesql] @SetMultiUser;
 IF DATABASEPROPERTYEX(DB_NAME(), 'UserAccess') <> 'MULTI_USER'
  BEGIN
   RAISERROR('Refresh of SQLClueCLR assembly failed at SET MULTI_USER. The database is not multi-user',20,1) WITH LOG;
  END 
END TRY 
BEGIN CATCH
 DECLARE @Msg [NVARCHAR](1024);  
 SET @Msg = ERROR_MESSAGE();
 RAISERROR('Refresh of SQLClueCLR assembly failed at SET MULTI_USER. Error Message: %s',20,1, @Msg) WITH LOG;
END CATCH

GO

IF NOT EXISTS (SELECT * FROM [sys].[fulltext_indexes] 
               WHERE [object_id] = OBJECT_ID('[SQLCfg].[tChange]')) 
 BEGIN
  IF PARSENAME(CONVERT(NVARCHAR(20), SERVERPROPERTY('ProductVersion')),4) < 10
    EXEC sp_executesql N'CREATE FULLTEXT INDEX ON [SQLCfg].[tChange]
     ([EventData], [Definition] LANGUAGE 0X0 )
    KEY INDEX [pkc_tChange__Id] ON [ftSQLConfigurationRepositoryCatalog]
    WITH CHANGE_TRACKING AUTO;'                    
  ELSE
    EXEC sp_executesql N'CREATE FULLTEXT INDEX ON [SQLCfg].[tChange]
     ([EventData], [Definition] LANGUAGE 0X0 )
    KEY INDEX [pkc_tChange__Id] ON [ftSQLConfigurationRepositoryCatalog]
    WITH (CHANGE_TRACKING AUTO, STOPLIST = SYSTEM);'                    
 END


/*
select * from sys.dm_fts_index_population
select * from sys.dm_fts_active_catalogs
select * from sys.fulltext_indexes
*/